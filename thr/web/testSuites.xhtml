<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Test Suites Result</title>
        <h:outputStylesheet library="css" name="thr.css" />
        <h:outputStylesheet library="css" name="primefaces-ex.css" />

        <script>
            function query(suite) {
                var start = PF("wv_start").getDate().getTime();
                var stop = PF("wv_stop").getDate().getTime();
                var number = PF("wv_number").value;
                var invisible = PF("wv_invisible").getSelectedValue();
                var search = "?start=" + start + "&amp;stop=" + stop + "&amp;number=" + number + "&amp;invisible=" + invisible;
                if (suite) {
                    search += "&amp;suite=" + suite;
                }
                location.search = search;
            }
        </script>
    </h:head>
    <h:body>

        <h:panelGrid>
            <h:outputText value="All Test Suite Results" style="font-size: x-large; font-variant: small-caps; font-weight: bold;" />
            <p:spacer width="10px" />
        </h:panelGrid>

        <h:panelGrid columns="20">
            <h:outputText value="From" />
            <p:calendar id="starttime" widgetVar="wv_start" pattern="yyyy-MM-dd HH:mm" value="#{testSuitesView.startTime}">
                <p:ajax event="dateSelect" oncomplete="query();" global="false" />
            </p:calendar>
            <h:outputText value="to" />
            <p:calendar id="stoptime" widgetVar="wv_stop" pattern="yyyy-MM-dd HH:mm" value="#{testSuitesView.stopTime}">
                <p:ajax event="dateSelect" oncomplete="query();" global="false" />
            </p:calendar>
            <h:outputText value="," />
            <h:outputText value="with maximum" />
            <p:spinner id="number" widgetVar="wv_number" value="#{testSuitesView.numberOfEntries}"
                       min="1" max="10000" size="5" onchange="query();" />
            <h:outputText value="entries," />
            <p:selectOneMenu id="invisibleIncluded" widgetVar="wv_invisible" value="#{testSuitesView.invisibleIncluded}"
                             onchange="query();">
                <f:selectItem id="invisibleIncluded_true" itemLabel="including invisible entries" itemValue="true" />
                <f:selectItem id="invisibleIncluded_false" itemLabel="including no invisible entries" itemValue="false" />
            </p:selectOneMenu>
        </h:panelGrid>

        <p:dataTable value="#{testSuitesView.results}" var="row" rowIndexVar="rowIndex" resizableColumns="true"
                     rowKey="#{row.get('SUITE_RESULT_ID')}" selection="#{testSuitesView.resultsSelected}">
            <p:column headerText="Index" width="36">
                <h:outputText value="#{rowIndex + 1}" />
            </p:column>
            <p:column selectionMode="multiple" width="16" rendered="#{not empty testSuitesView.suiteName}"/>

            <p:column width="80">
                <f:facet name="header">
                    <h:outputText value="Execution&#10;Id" escape="false" style="white-space: pre-line;" />
                </f:facet>
                <h:outputText value="#{row.get('_EXEC_ID')}" style="font-family: monospace" />
            </p:column>

            <p:column headerText="Test Suite Name">
                <h:outputText value="#{row.get('SUITE_NAME')}" />
            </p:column>
            <p:column headerText="Job Name" width="168">
                <nobr><h:outputText value="#{row.get('JOB_NAME')}" /></nobr>
            </p:column>

            <ui:param name="bn" value="#{row.get('JOB_BUILD_NUMBER')}" />
            <p:column width="40">
                <f:facet name="header">
                    <h:outputText value="Build&#10;#" escape="false" style="white-space: pre-line;" />
                </f:facet>
                <h:outputText value="#{bn}" rendered="#{bn gt 0}" />
            </p:column>

            <ui:param name="result" value="#{row.get('EXECUTION_RESULT')}" />
            <p:column headerText="Result" width="68">
                <h:outputText value="#{result}" class="result-pass" rendered="#{result eq 'PASS'}"/>
                <h:outputText value="#{result}" class="result-fail" rendered="#{result ne 'PASS'}"/>
            </p:column>

            <p:column width="50">
                <f:facet name="header">
                    <h:outputText value="# of&#10;Tests" escape="false" style="white-space: pre-line;" />
                </f:facet>
                <h:outputText value="#{row.get('NUMBER_OF_TESTS')}" />
            </p:column>

            <p:column width="58">
                <f:facet name="header">
                    <h:outputText value="# of&#10;Failed" escape="false" style="white-space: pre-line;" />
                </f:facet>
                <h:outputText value="#{row.get('NUMBER_OF_FAILURE')}"/>
            </p:column>

            <p:column headerText="Start Time" width="166">
                <nobr>
                    <h:outputText value="#{mySqlBaseBean.convertToDate(row.get('START_TIME'))}" style="font-family: monospace">
                        <f:convertDateTime type="date" pattern="EEE yyyy-MM-dd HH:mm:ss" timeZone="US/Pacific" />
                    </h:outputText>
                </nobr>
            </p:column>
            <p:column headerText="Stop Time" width="98">
                <nobr>
                    <h:outputText value="#{mySqlBaseBean.convertToDate(row.get('STOP_TIME'))}" style="font-family: monospace">
                        <f:convertDateTime type="date" pattern="MM-dd HH:mm:ss" timeZone="US/Pacific" />
                    </h:outputText>
                </nobr>
            </p:column>
        </p:dataTable>

        <script>
            jQuery(document).ready(function () {
                console.log(location);
            });
        </script>
    </h:body>
</html>
