<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>test suites result</title>
        <h:outputStylesheet library="css" name="default.css" />
        <h:outputStylesheet library="css" name="table-style.css" />
        <h:outputScript library="js" name="jstz.js" />
    </h:head>
    <h:body>
        <h3>Suites Result</h3>

        <f:metadata>
            <f:viewParam name="number" value="#{suitesBean.number}" />
            <f:viewParam name="invisibleIncluded" value="#{suitesBean.invisibleIncluded}" />

            <f:event type="preRenderView" listener="#{suitesBean.init}" />
        </f:metadata>

        <h:form id="form">
            <h:panelGrid id="panel" columns="4" border="0" cellpadding="5" cellspacing="0">
                <h:panelGroup>
                    <h:outputLabel id="lstarttime" for="starttime" value="start: "/>
                    <p:calendar id="starttime" pattern="yyyy-MM-dd HH:mm" value="#{suitesBean.startTime}" />
                </h:panelGroup>
                <h:panelGroup>
                    <h:outputLabel id="lstoptime" for="stoptime" value="stop: " />
                    <p:calendar id="stoptime" pattern="yyyy-MM-dd HH:mm" value="#{suitesBean.stopTime}" />
                </h:panelGroup>
                <h:panelGroup>
                    <h:outputLabel id="lnumber" for="number" value="maximum number of records: "/>
                    <h:inputText value="#{suitesBean.number}" id="number" />
                </h:panelGroup>
                <h:selectBooleanCheckbox id="invisibleIncluded" value="#{suitesBean.invisibleIncluded}" >
                    include invisible entries
                </h:selectBooleanCheckbox>
                <h:commandButton id="query" value="query" action="suites">
                    <f:param name="jobname" value="#{suitesBean.jobName}" />
                </h:commandButton>
                <h:commandButton id="queryall" value="query all" action="suites.xhtml"
                                 rendered="#{not empty suitesBean.jobName}">
                    <f:param name="jobname" value="" />
                </h:commandButton>
                <h:panelGroup>
                    <h:link id="suitehistorydetail" value="suite history detail"
                            outcome="suite-history-detail"
                            rendered='#{not empty suitesBean.jobName}'
                            target="_blank">
                        <f:param name="suiteids" value="#{suitesBean.suiteIds}" />
                    </h:link>
                    <h:outputLabel value="&nbsp; &nbsp;" />
                    <h:link id="suitehistorydetailfailonly" value="(failure only)"
                            outcome="suite-history-detail"
                            rendered='#{not empty suitesBean.jobName}'
                            target="_blank">
                        <f:param name="suiteids" value="#{suitesBean.suiteIds}" />
                        <f:param name="failonly" value="true" />
                    </h:link>
                </h:panelGroup>
                <h:link id="perfhistory" value="perf history"
                        outcome="perf-history"
                        rendered='#{not empty suitesBean.jobName}'
                        target="_blank">
                    <f:param name="suiteids" value="#{suitesBean.suiteIds}" />
                </h:link>
            </h:panelGrid>

            <h:dataTable value="#{suitesBean.suites}" 
                         var="suite"
                         styleClass="order-table"
                         headerClass="order-table-header"
                         rowClasses="order-table-odd-row, order-table-even-row"
                         columnClasses="table-col-center,table-col-center,table-col-left,table-col-center,table-col-center,table-col-center,
                         table-col-right,table-col-right,table-col-right,table-col-right"
                         border="1">
                <h:column>
                    <f:facet name="header">index</f:facet>
                        #{suite.get("_row_index")}
                </h:column>                    

                <h:column>
                    <f:facet name="header">id</f:facet>
                    <h:link value="#{suite.get('_result_id')}" outcome="suite" target="_blank">
                        <f:param name="srid" value="#{suite.get('SUITE_RESULT_ID')}" />
                    </h:link>
                </h:column>

                <h:column>
                    <f:facet name="header">job name</f:facet>
                    <h:link value="#{suite.get('JOB_NAME')}" outcome="suites" rendered="#{not empty suite.get('JOB_NAME')}">
                        <f:param name="jobname" value="#{suite.get('JOB_NAME')}" />
                    </h:link>
                </h:column>
                <h:column>
                    <f:facet name="header">job build #</f:facet>
                    <h:panelGroup rendered="#{suite.get('JOB_BUILD_NUMBER') != 0}" >
                        <h:outputLink target="_blank" value="#{suite.get('JOB_BUILD_URL')}">
                            <h:outputText value="#{suite.get('JOB_BUILD_NUMBER')}" />
                        </h:outputLink>                        
                    </h:panelGroup>
                </h:column>

                <h:column>
                    <f:facet name="header">result</f:facet>
                    <h:outputText value='#{suite.get("EXECUTION_RESULT")}'
                                  class='#{suite.get("_row_result")? "pass": "fail"}' />
                </h:column>

                <h:column>
                    <f:facet name="header">total</f:facet>
                        #{suite.get("NUMBER_OF_TESTS")}
                </h:column>
                <h:column>
                    <f:facet name="header">failures</f:facet>
                        #{suite.get("NUMBER_OF_FAILURE")}
                </h:column>

                <h:column>
                    <f:facet name="header">time</f:facet>
                        #{suite.get("_exec_time")}
                </h:column>
                <h:column>
                    <f:facet name="header">start</f:facet>
                    <nobr>
                        <h:outputText value="#{suitesBean.convertToDate(suite.get('START_TIME'))}">
                            <f:convertDateTime type="date" pattern="EEE yyyy-MM-dd HH:mm:ss" timeZone="US/Pacific" />
                        </h:outputText>
                    </nobr>
                </h:column>
                <h:column>
                    <f:facet name="header">stop</f:facet>
                    <nobr>
                        <h:outputText value="#{suitesBean.convertToDate(suite.get('STOP_TIME'))}">
                            <f:convertDateTime type="date" pattern="HH:mm:ss" timeZone="US/Pacific" />
                        </h:outputText>
                    </nobr>
                </h:column>
            </h:dataTable>
        </h:form>

        <script>
            setInterval(function() {
                document.getElementById("form:query").click();
            }, 60000);
        </script>
    </h:body>
</html>
